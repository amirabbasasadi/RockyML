\hypertarget{system_8h_source}{}\doxysection{system.\+h}
\label{system_8h_source}\index{include/rocky/zagros/system.h@{include/rocky/zagros/system.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{    Copyright (C) 2022 Amirabbas Asadi , All Rights Reserved}}
\DoxyCodeLine{3 \textcolor{comment}{    distributed under Apache-\/2.0 license}}
\DoxyCodeLine{4 \textcolor{comment}{*/}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#ifndef ROCKY\_ZAGROS\_SYSTEM\_GUARD}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#define ROCKY\_ZAGROS\_SYSTEM\_GUARD}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include<iostream>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include<string>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include<memory>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include<tbb/tbb.h>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}spdlog/spdlog.h"{}}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{namespace }rocky\{}
\DoxyCodeLine{17 \textcolor{keyword}{namespace }zagros\{}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T\_e>}
\DoxyCodeLine{20 \textcolor{keyword}{class }\mbox{\hyperlink{classrocky_1_1zagros_1_1system}{system}}\{}
\DoxyCodeLine{21 \textcolor{keyword}{public}:}
\DoxyCodeLine{22     \textcolor{keyword}{virtual} T\_e objective(T\_e* params) = 0;}
\DoxyCodeLine{28     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1system_a8c585163cd377259b6bff2fd9f91276f}{lower\_bound}}()\{ \textcolor{keywordflow}{return} -\/1.0;\}}
\DoxyCodeLine{35     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1system_af66470532b8171aed8913540198d22b8}{lower\_bound}}(\textcolor{keywordtype}{int} p\_index)\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classrocky_1_1zagros_1_1system_af66470532b8171aed8913540198d22b8}{lower\_bound}}();\}}
\DoxyCodeLine{41     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1system_a93ad8b3e28cafbcaecfc14e92c8224dc}{upper\_bound}}()\{ \textcolor{keywordflow}{return} 1.0;\}}
\DoxyCodeLine{48     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1system_aae46b9b38e1bb1354373ca85da9a7edf}{upper\_bound}}(\textcolor{keywordtype}{int} p\_index)\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{classrocky_1_1zagros_1_1system_aae46b9b38e1bb1354373ca85da9a7edf}{upper\_bound}}();\}}
\DoxyCodeLine{49     \textcolor{keyword}{virtual} std::string to\_string()\{}
\DoxyCodeLine{50         \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}optimization problem"{}};}
\DoxyCodeLine{51     \}}
\DoxyCodeLine{52 \};}
\DoxyCodeLine{53 }
\DoxyCodeLine{58 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T\_e>}
\DoxyCodeLine{59 \textcolor{keyword}{class }\mbox{\hyperlink{classrocky_1_1zagros_1_1blocked__system}{blocked\_system}}: \textcolor{keyword}{public} \mbox{\hyperlink{classrocky_1_1zagros_1_1system}{system}}<T\_e>\{}
\DoxyCodeLine{60 \textcolor{keyword}{public}:}
\DoxyCodeLine{61     \textcolor{keywordtype}{int} block\_dim\_;}
\DoxyCodeLine{62     \textcolor{keywordtype}{int} original\_dim\_;}
\DoxyCodeLine{63     \textcolor{comment}{// thread-\/specific solution states provided by the runtime}}
\DoxyCodeLine{64     tbb::enumerable\_thread\_specific<std::vector<T\_e>>* solution\_state\_;}
\DoxyCodeLine{65     \textcolor{comment}{// main system}}
\DoxyCodeLine{66     \mbox{\hyperlink{classrocky_1_1zagros_1_1system}{system<T\_e>}}* main\_system\_;}
\DoxyCodeLine{67     \textcolor{comment}{// block mask}}
\DoxyCodeLine{68     \textcolor{keywordtype}{int}* bcd\_mask\_;}
\DoxyCodeLine{69     }
\DoxyCodeLine{70     \textcolor{keywordtype}{int} original\_dim()\textcolor{keyword}{ const}\{}
\DoxyCodeLine{71         \textcolor{keywordflow}{return} original\_dim\_;}
\DoxyCodeLine{72     \}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \textcolor{keywordtype}{int} block\_dim()\textcolor{keyword}{ const}\{}
\DoxyCodeLine{75         \textcolor{keywordflow}{return} block\_dim\_;}
\DoxyCodeLine{76     \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78     \mbox{\hyperlink{classrocky_1_1zagros_1_1blocked__system}{blocked\_system}}(\mbox{\hyperlink{classrocky_1_1zagros_1_1system}{system<T\_e>}}* main\_system, \textcolor{keywordtype}{int} original\_dim, \textcolor{keywordtype}{int} block\_dim, \textcolor{keywordtype}{int}* mask)\{}
\DoxyCodeLine{79         this-\/>main\_system\_ = main\_system;}
\DoxyCodeLine{80         this-\/>original\_dim\_ = original\_dim;}
\DoxyCodeLine{81         this-\/>block\_dim\_ = block\_dim;}
\DoxyCodeLine{82         this-\/>bcd\_mask\_ = mask;}
\DoxyCodeLine{83     \}}
\DoxyCodeLine{84     \textcolor{comment}{// change the solution state}}
\DoxyCodeLine{85     \textcolor{keywordtype}{void} set\_solution\_state(tbb::enumerable\_thread\_specific<std::vector<T\_e>>* solution\_state)\{}
\DoxyCodeLine{86         this-\/>solution\_state\_ = solution\_state;}
\DoxyCodeLine{87     \}}
\DoxyCodeLine{88     \textcolor{keyword}{virtual} T\_e objective(T\_e* partial)\{}
\DoxyCodeLine{89         \textcolor{comment}{// get a thread specific solution}}
\DoxyCodeLine{90         T\_e* full\_solution = this-\/>solution\_state\_-\/>local().data();}
\DoxyCodeLine{91         \textcolor{comment}{// copy the partial solution to the full solution}}
\DoxyCodeLine{92         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i=0; i<block\_dim\_; i++)}
\DoxyCodeLine{93             full\_solution[bcd\_mask\_[i]] = partial[i];}
\DoxyCodeLine{94         \textcolor{comment}{// evaluate the full solution}}
\DoxyCodeLine{95         \textcolor{keywordflow}{return} main\_system\_-\/>objective(full\_solution);}
\DoxyCodeLine{96     \}}
\DoxyCodeLine{102     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1blocked__system_a8eb5edaa693d5e6632504e0dd53f2954}{lower\_bound}}()\{ \textcolor{keywordflow}{return} this-\/>main\_system\_-\/>\mbox{\hyperlink{classrocky_1_1zagros_1_1system_a8c585163cd377259b6bff2fd9f91276f}{lower\_bound}}();\}}
\DoxyCodeLine{109     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1blocked__system_acb5d961046921fd09b6e56885148a2d5}{lower\_bound}}(\textcolor{keywordtype}{int} p\_index)\{ \textcolor{keywordflow}{return} this-\/>main\_system\_-\/>\mbox{\hyperlink{classrocky_1_1zagros_1_1system_a8c585163cd377259b6bff2fd9f91276f}{lower\_bound}}(bcd\_mask\_[p\_index]);\}}
\DoxyCodeLine{115     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1blocked__system_ac4929cf6fd9374c72e68ae32b7467003}{upper\_bound}}()\{ \textcolor{keywordflow}{return} this-\/>main\_system\_-\/>\mbox{\hyperlink{classrocky_1_1zagros_1_1system_a93ad8b3e28cafbcaecfc14e92c8224dc}{upper\_bound}}();\}}
\DoxyCodeLine{122     \textcolor{keyword}{virtual} T\_e \mbox{\hyperlink{classrocky_1_1zagros_1_1blocked__system_a1883a6aa82ebcc064459b2b55d7320fb}{upper\_bound}}(\textcolor{keywordtype}{int} p\_index)\{ \textcolor{keywordflow}{return} this-\/>main\_system\_-\/>\mbox{\hyperlink{classrocky_1_1zagros_1_1system_a93ad8b3e28cafbcaecfc14e92c8224dc}{upper\_bound}}(bcd\_mask\_[p\_index]);\}}
\DoxyCodeLine{123 \};}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \}; \textcolor{comment}{// end of zagros namespace}}
\DoxyCodeLine{126 \}; \textcolor{comment}{// end of rocky namespace}}
\DoxyCodeLine{127 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
